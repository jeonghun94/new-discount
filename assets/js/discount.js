/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
/******/ (() => { // webpackBootstrap
/******/ 	var __webpack_modules__ = ({

/***/ "./src/client/js/discount.js":
/*!***********************************!*\
  !*** ./src/client/js/discount.js ***!
  \***********************************/
/***/ (() => {

eval("const SEARCH_ARTICLE = document.querySelector(\"#searchArticle\");\r\nconst CRUD_ARTICLE = document.querySelector(\"#crudArticle\");\r\nconst LIST_DIV = document.querySelector(\"#listDiv\");\r\n\r\nconst searchBtn = document.querySelector(\"#searchBtn\");\r\nconst preBtn = document.querySelector(\"#preBtn\");\r\nconst inCarNo = document.querySelector(\"#inCarNo\");\r\n\r\nconst COUPON_CONTAINER = document.createElement(\"div\");\r\nCOUPON_CONTAINER.classList.add(\"coupon__container\");\r\nCOUPON_CONTAINER.id = \"couponContainer\";\r\n\r\nconst DISCOUNT_CONTAINER = document.createElement(\"div\");\r\nDISCOUNT_CONTAINER.classList.add(\"discount__container\");\r\n\r\n//숫자만 입력받기\r\nfunction checkVal() {\r\n  this.value = this.value.replace(/[^0-9]/g, \"\");\r\n}\r\n\r\n//차량조회 돌아가기\r\nfunction backToSearch() {\r\n  SEARCH_ARTICLE.style.display = \"block\";\r\n  CRUD_ARTICLE.style.display = \"none\";\r\n  CRUD_ARTICLE.querySelector(\".search__container\").remove();\r\n  CRUD_ARTICLE.querySelector(\".coupon__container\").remove();\r\n  COUPON_CONTAINER.innerHTML = \"\";\r\n  DISCOUNT_CONTAINER.innerHTML = \"\";\r\n}\r\n\r\n//조히내역 없음\r\nfunction nodata(container) {\r\n  const noDataContainer = document.createElement(\"div\");\r\n  noDataContainer.classList.add(\"nodata__container\");\r\n\r\n  const icon = document.createElement(\"i\");\r\n  icon.classList.add(\"fas\", \"fa-exclamation\");\r\n\r\n  const p = document.createElement(\"p\");\r\n  p.innerText = \"조회된 내역이 없습니다.\";\r\n\r\n  noDataContainer.appendChild(icon);\r\n  noDataContainer.appendChild(p);\r\n\r\n  container.append(noDataContainer);\r\n}\r\n\r\n//차량조회 리스트 추가\r\nfunction appendSearchList(result) {\r\n  LIST_DIV.innerHTML = \"\";\r\n  if (result.length !== 0) {\r\n    for (var i = 0; i < result.length; i++) {\r\n      const container = document.createElement(\"div\");\r\n      container.classList.add(\"search__container\");\r\n      container.dataset.inseqno = result[i].inSeqNo;\r\n\r\n      const img = document.createElement(\"img\");\r\n      img.classList.add(\"search__img\");\r\n      img.src = `${\"http://smcity.iptime.org\"}:${\"80\"}/${result[i].inCarPicName}`;\r\n      img.alt = \"이미지를 불러오지 못했습니다.\";\r\n\r\n      const info = document.createElement(\"div\");\r\n      info.classList.add(\"search__info\");\r\n\r\n      const inCarNo = document.createElement(\"p\");\r\n      inCarNo.innerText = result[i].inCarNo;\r\n\r\n      const tkType = document.createElement(\"p\");\r\n      tkType.innerText = `입차종류: ${result[i].tkType}`;\r\n\r\n      const unitName = document.createElement(\"p\");\r\n      unitName.innerText = `입차장비: ${result[i].unitName}`;\r\n\r\n      const insDate = document.createElement(\"p\");\r\n      insDate.innerText = `입차시간: ${result[i].insDate.substring(\r\n        5,\r\n        result[i].insDate.length - 3\r\n      )}`;\r\n\r\n      info.appendChild(inCarNo);\r\n      info.appendChild(tkType);\r\n      info.appendChild(unitName);\r\n      info.appendChild(insDate);\r\n\r\n      container.appendChild(img);\r\n      container.appendChild(info);\r\n\r\n      LIST_DIV.append(container);\r\n    }\r\n  } else {\r\n    nodata(LIST_DIV);\r\n  }\r\n\r\n  const searchInCarByInSeqNo = document.querySelectorAll(\".search__container\");\r\n  searchInCarByInSeqNo.forEach((x) => {\r\n    x.addEventListener(\"click\", (e) => {\r\n      const inSeqNo = e.currentTarget.dataset.inseqno;\r\n      const cloneNode = e.currentTarget.cloneNode(true);\r\n      SEARCH_ARTICLE.style.display = \"none\";\r\n      CRUD_ARTICLE.style.display = \"block\";\r\n\r\n      searchInSeqNo(inSeqNo, cloneNode);\r\n    });\r\n  });\r\n}\r\n\r\n//차량조회 테스트\r\nfunction searchInCarT() {\r\n  fetch(`/search-in-car`, {\r\n    method: \"POST\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n  })\r\n    .then((response) => response.json())\r\n    .then((data) => {\r\n      const { result } = data;\r\n\r\n      const testInCarNo = result[0].inCarNo;\r\n\r\n      inCarNo.value = testInCarNo.substring(\r\n        testInCarNo.length - 4,\r\n        testInCarNo.length\r\n      );\r\n\r\n      result.map((x, idx) => {\r\n        console.log(`${idx + 1}.${x.inCarNo}`);\r\n      });\r\n\r\n      searchBtn.click();\r\n    })\r\n    .catch((error) => console.log(error));\r\n}\r\n\r\n//차량조회(차량번호)\r\nfunction searchInCar() {\r\n  if (inCarNo.value.length === 4) {\r\n    fetch(`/discount/search`, {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({\r\n        inCarNo: inCarNo.value,\r\n      }),\r\n    })\r\n      .then((response) => response.json())\r\n      .then((data) => {\r\n        const { result } = data;\r\n        appendSearchList(result);\r\n      })\r\n      .catch((error) => console.log(error));\r\n  } else {\r\n    alert(\"차량번호는 4자리이어야 합니다.\");\r\n  }\r\n}\r\n\r\n//차량조회 + 쿠폰조회 + 할인내역조회\r\nfunction searchInSeqNo(inSeqNo, cloneNode) {\r\n  fetch(`/discount/search/inseqno`, {\r\n    method: \"POST\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n    body: JSON.stringify({\r\n      inSeqNo,\r\n    }),\r\n  })\r\n    .then((response) => response.json())\r\n    .then((data) => {\r\n      const { freeCouponList, payCouponList, discountList: dList } = data;\r\n\r\n      //조회 내역 복제 및 할인권, 할인내역 Container 추가\r\n      CRUD_ARTICLE.append(cloneNode);\r\n      CRUD_ARTICLE.querySelector(\".search__container\").style.border = \"none\";\r\n      CRUD_ARTICLE.append(COUPON_CONTAINER);\r\n      CRUD_ARTICLE.append(DISCOUNT_CONTAINER);\r\n\r\n      //할인권 리스트 추가\r\n      couponList(freeCouponList, \"무료\");\r\n      couponList(payCouponList, \"유료\");\r\n      couponInvalid();\r\n\r\n      //할인내역 리스트 추가\r\n      discountList(dList, inSeqNo);\r\n    })\r\n    .catch((error) => console.log(error));\r\n}\r\n\r\n//할인내역 추가\r\nfunction discountList(list, inSeqNo) {\r\n  if (list.length !== 0) {\r\n    const discountHeader = document.createElement(\"div\");\r\n    discountHeader.classList.add(\"discount__header\");\r\n    discountHeader.innerHTML = \"할인내역\";\r\n    DISCOUNT_CONTAINER.append(discountHeader);\r\n\r\n    list.map((x) => {\r\n      const discountInfoContainer = document.createElement(\"div\");\r\n      discountInfoContainer.classList.add(\"discount__info-container\");\r\n      discountInfoContainer.dataset.idx = x.idx;\r\n      console.log(x.idx);\r\n\r\n      const discountInfo = document.createElement(\"div\");\r\n      discountInfo.classList.add(\"discount__info\");\r\n\r\n      const discounInfoTitle = document.createElement(\"p\");\r\n      discounInfoTitle.classList.add(\"discount__info-title\");\r\n      discounInfoTitle.innerText = `${x.dcName} 할인권`;\r\n\r\n      const discountInfoShopName = document.createElement(\"p\");\r\n      discountInfoShopName.innerText = `등록매장: ${x.shopName}`;\r\n\r\n      const discountInfoInDate = document.createElement(\"p\");\r\n      discountInfoInDate.innerText = `등록일시: ${x.inTime.substring(\r\n        0,\r\n        10\r\n      )} ${x.inTime.substring(11, 19)}`;\r\n\r\n      discountInfo.appendChild(discounInfoTitle);\r\n      discountInfo.appendChild(discountInfoShopName);\r\n      discountInfo.appendChild(discountInfoInDate);\r\n\r\n      const discountInfoDelete = document.createElement(\"div\");\r\n      discountInfoDelete.classList.add(\"discount__info-delete\");\r\n      discountInfoDelete.innerHTML = \"삭제\";\r\n\r\n      discountInfoDelete.addEventListener(\"click\", (e) => {\r\n        const idx = e.currentTarget.parentNode.dataset.idx;\r\n        deleteList(idx, inSeqNo);\r\n      });\r\n\r\n      discountInfoContainer.appendChild(discountInfo);\r\n      discountInfoContainer.appendChild(discountInfoDelete);\r\n\r\n      DISCOUNT_CONTAINER.append(discountInfoContainer);\r\n    });\r\n  } else {\r\n    // const noDataContainer = document.createElement(\"div\");\r\n    // noDataContainer.classList.add(\"nodata__container\");\r\n\r\n    // const icon = document.createElement(\"i\");\r\n    // icon.classList.add(\"fas\", \"fa-exclamation\");\r\n\r\n    // const p = document.createElement(\"p\");\r\n    // p.innerText = \"조회된 내역이 없습니다.\";\r\n\r\n    // noDataContainer.appendChild(icon);\r\n    // noDataContainer.appendChild(p);\r\n\r\n    // DISCOUNT_CONTAINER.append(noDataContainer);\r\n    nodata(DISCOUNT_CONTAINER);\r\n  }\r\n}\r\n\r\n//무료권 혹 유료권 2개가 아닐시 명칭 변경\r\nfunction couponInvalid() {\r\n  const coupon = document.querySelectorAll(\".coupon__container-type\");\r\n\r\n  if (coupon.length === 1) {\r\n    coupon[0].querySelector(\"h6\").innerText = \"할인권\";\r\n  }\r\n}\r\n\r\n//할인권 SELECT 추가\r\nfunction couponList(list, text) {\r\n  if (list.length !== 0) {\r\n    const type = document.createElement(\"div\");\r\n    type.classList.add(\"coupon__container-type\");\r\n\r\n    const typeText = document.createElement(\"h6\");\r\n    typeText.innerText = `${text}권`;\r\n\r\n    const select = document.createElement(\"select\");\r\n    select.classList.add(\"coupon__list\");\r\n\r\n    const option = document.createElement(\"option\");\r\n    option.innerText = \"할인권 선택\";\r\n    option.value = \"00\";\r\n\r\n    select.append(option);\r\n\r\n    //할인권 선택 시 할인 내역 추가\r\n    select.addEventListener(\"change\", (e) => {\r\n      const inSeqNo =\r\n        CRUD_ARTICLE.querySelector(\".search__container\").dataset.inseqno;\r\n      const { text: dcName, value: couponType } = e.currentTarget;\r\n\r\n      if (couponType !== \"00\" && confirm(`할인권을 등록하시겠습니까?`)) {\r\n        insertList(inSeqNo, couponType);\r\n      }\r\n    });\r\n\r\n    list.map((x) => {\r\n      const option = document.createElement(\"option\");\r\n      option.innerText = `${x.dcName}`;\r\n      option.value = `${x.couponType}`;\r\n      select.append(option);\r\n    });\r\n\r\n    type.append(typeText);\r\n    type.append(select);\r\n\r\n    COUPON_CONTAINER.append(type);\r\n  }\r\n}\r\n\r\n//할인권 삭제\r\nfunction deleteList(idx, inSeqNo) {\r\n  if (confirm(\"할인내역을 삭제하시겠습니까?\")) {\r\n    fetch(`/discount/list`, {\r\n      method: \"DELETE\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({\r\n        inSeqNo,\r\n        idx,\r\n      }),\r\n    })\r\n      .then((response) => response.json())\r\n      .then((data) => {\r\n        if (data.result) {\r\n          DISCOUNT_CONTAINER.innerHTML = \"\";\r\n          discountList(data.list, inSeqNo);\r\n        }\r\n      })\r\n      .catch((error) => console.log(error));\r\n  }\r\n}\r\n\r\n//할인내역 추가\r\nfunction insertList(inSeqNo, couponType) {\r\n  if (couponType !== \"00\") {\r\n    fetch(`/discount/list`, {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({\r\n        inSeqNo,\r\n        couponType,\r\n      }),\r\n    })\r\n      .then((response) => response.json())\r\n      .then((data) => {\r\n        if (data.result) {\r\n          DISCOUNT_CONTAINER.innerHTML = \"\";\r\n          discountList(data.list, inSeqNo);\r\n        }\r\n      })\r\n      .catch((error) => console.log(error));\r\n  }\r\n}\r\n\r\n//이벤트 리스너\r\npreBtn.addEventListener(\"click\", backToSearch);\r\nsearchBtn.addEventListener(\"click\", searchInCar);\r\n\r\ninCarNo.addEventListener(\"input\", checkVal);\r\ninCarNo.addEventListener(\"keyup\", function (e) {\r\n  if (window.event.keyCode == 13) {\r\n    searchInCar();\r\n  }\r\n});\r\n\r\nwindow.onload = function () {\r\n  console.log(\"http://smcity.iptime.org\");\r\n  console.log(\"80\");\r\n  inCarNo.focus();\r\n  CRUD_ARTICLE.style.display = \"none\";\r\n\r\n  const footer = document.querySelector(\"footer\");\r\n  footer.addEventListener(\"click\", searchInCarT);\r\n};\r\n\n\n//# sourceURL=webpack://node_web/./src/client/js/discount.js?");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module can't be inlined because the eval devtool is used.
/******/ 	var __webpack_exports__ = {};
/******/ 	__webpack_modules__["./src/client/js/discount.js"]();
/******/ 	
/******/ })()
;
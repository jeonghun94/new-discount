(()=>{var e=document.querySelector("#searchArticle"),n=document.querySelector("#crudArticle"),t=document.querySelector("#listDiv"),c=document.querySelector("#searchBtn"),o=document.querySelector("#preBtn"),a=document.querySelector("#inCarNo"),i=document.createElement("div");i.classList.add("coupon__container"),i.id="couponContainer";var r=document.createElement("div");function d(e){var n=document.createElement("div");n.classList.add("nodata__container");var t=document.createElement("i");t.classList.add("fas","fa-exclamation");var c=document.createElement("p");c.innerText="조회된 내역이 없습니다.",n.appendChild(t),n.appendChild(c),e.append(n)}function s(){fetch("/search-in-car",{method:"POST",headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){var n=e.result,t=n[0].inCarNo;a.value=t.substring(t.length-4,t.length),n.map((function(e,n){console.log("".concat(n+1,".").concat(e.inCarNo))})),c.click()})).catch((function(e){return console.log(e)}))}function l(){4===a.value.length?fetch("/discount/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({inCarNo:a.value})}).then((function(e){return e.json()})).then((function(c){!function(c){if(t.innerHTML="",0!==c.length)for(var o=0;o<c.length;o++){var a=document.createElement("div");a.classList.add("search__container"),a.dataset.inseqno=c[o].inSeqNo;var s=document.createElement("img");s.classList.add("search__img"),s.src="".concat("http://smcity.iptime.org",":").concat("80","/").concat(c[o].inCarPicName),s.alt="이미지를 불러오지 못했습니다.";var l=document.createElement("div");l.classList.add("search__info");var m=document.createElement("p");m.innerText=c[o].inCarNo;var h=document.createElement("p");h.innerText="입차종류: ".concat(c[o].tkType);var f=document.createElement("p");f.innerText="입차장비: ".concat(c[o].unitName);var v=document.createElement("p");v.innerText="입차시간: ".concat(c[o].insDate.substring(5,c[o].insDate.length-3)),l.appendChild(m),l.appendChild(h),l.appendChild(f),l.appendChild(v),a.appendChild(s),a.appendChild(l),t.append(a)}else d(t);document.querySelectorAll(".search__container").forEach((function(t){t.addEventListener("click",(function(t){var c=t.currentTarget.dataset.inseqno,o=t.currentTarget.cloneNode(!0);e.style.display="none",n.style.display="block",function(e,t){fetch("/discount/search/inseqno",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({inSeqNo:e})}).then((function(e){return e.json()})).then((function(c){var o,a=c.freeCouponList,d=c.payCouponList,s=c.discountList;n.append(t),n.querySelector(".search__container").style.border="none",n.append(i),n.append(r),p(a,"무료"),p(d,"유료"),1===(o=document.querySelectorAll(".coupon__container-type")).length&&(o[0].querySelector("h6").innerText="할인권"),u(s,e)})).catch((function(e){return console.log(e)}))}(c,o)}))}))}(c.result)})).catch((function(e){return console.log(e)})):alert("차량번호는 4자리이어야 합니다.")}function u(e,n){if(0!==e.length){var t=document.createElement("div");t.classList.add("discount__header"),t.innerHTML="할인내역",r.append(t),e.map((function(e){var t=document.createElement("div");t.classList.add("discount__info-container"),t.dataset.idx=e.idx,console.log(e.idx);var c=document.createElement("div");c.classList.add("discount__info");var o=document.createElement("p");o.classList.add("discount__info-title"),o.innerText="".concat(e.dcName," 할인권");var a=document.createElement("p");a.innerText="등록매장: ".concat(e.shopName);var i=document.createElement("p");i.innerText="등록일시: ".concat(e.inTime.substring(0,10)," ").concat(e.inTime.substring(11,19)),c.appendChild(o),c.appendChild(a),c.appendChild(i);var d=document.createElement("div");d.classList.add("discount__info-delete"),d.innerHTML="삭제",d.addEventListener("click",(function(e){!function(e,n){confirm("할인내역을 삭제하시겠습니까?")&&fetch("/discount/list",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({inSeqNo:n,idx:e})}).then((function(e){return e.json()})).then((function(e){e.result&&(r.innerHTML="",u(e.list,n))})).catch((function(e){return console.log(e)}))}(e.currentTarget.parentNode.dataset.idx,n)})),t.appendChild(c),t.appendChild(d),r.append(t)}))}else d(r)}function p(e,t){if(0!==e.length){var c=document.createElement("div");c.classList.add("coupon__container-type");var o=document.createElement("h6");o.innerText="".concat(t,"권");var a=document.createElement("select");a.classList.add("coupon__list");var d=document.createElement("option");d.innerText="할인권 선택",d.value="00",a.append(d),a.addEventListener("change",(function(e){var t=n.querySelector(".search__container").dataset.inseqno,c=e.currentTarget,o=(c.text,c.value);"00"!==o&&confirm("할인권을 등록하시겠습니까?")&&function(e,n){"00"!==n&&fetch("/discount/list",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({inSeqNo:e,couponType:n})}).then((function(e){return e.json()})).then((function(n){n.result&&(r.innerHTML="",document.querySelector("select").value="00",u(n.list,e))})).catch((function(e){return console.log(e)}))}(t,o)})),e.map((function(e){var n=document.createElement("option");n.innerText="".concat(e.dcName),n.value="".concat(e.couponType),a.append(n)})),c.append(o),c.append(a),i.append(c)}}r.classList.add("discount__container"),o.addEventListener("click",(function(){e.style.display="block",n.style.display="none",n.querySelector(".search__container").remove(),n.querySelector(".coupon__container").remove(),i.innerHTML="",r.innerHTML=""})),c.addEventListener("click",l),a.addEventListener("input",(function(){this.value=this.value.replace(/[^0-9]/g,"")})),a.addEventListener("keyup",(function(e){13==window.event.keyCode&&l()})),window.onload=function(){a.focus(),n.style.display="none",document.querySelector("footer").addEventListener("click",s),"/discount/history"===window.location.pathname&&flatpickr(document.querySelector("#calender"))}})();
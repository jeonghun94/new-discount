(()=>{var e=document.querySelector("#searchArticle"),n=document.querySelector("#crudArticle"),t=document.querySelector("#listDiv"),c=document.querySelector("#searchBtn"),a=document.querySelector("#preBtn"),o=document.querySelector("#inCarNo"),i=document.createElement("div");i.classList.add("coupon__container"),i.id="couponContainer";var r=document.createElement("div");function d(){this.value=this.value.replace(/[^0-9]/g,"")}function l(){e.style.display="block",n.style.display="none",n.querySelector(".search__container").remove(),n.querySelector(".coupon__container").remove(),i.innerHTML="",r.innerHTML=""}function u(e){var n=document.createElement("div");n.classList.add("nodata__container");var t=document.createElement("i");t.classList.add("fas","fa-exclamation");var c=document.createElement("p");c.innerText="조회된 내역이 없습니다.",n.appendChild(t),n.appendChild(c),e.append(n)}function s(){fetch("/search-in-car",{method:"POST",headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){var n=e.result;if(n.length>0){var t=n[0].inCarNo;o.value=t.substring(t.length-4,t.length),c.click()}})).catch((function(e){return console.log(e)}))}function p(){4===o.value.length?fetch("/discount/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({inCarNo:o.value})}).then((function(e){return e.json()})).then((function(c){var a;a=c.result,t.innerHTML="",0!==a.length?a.map((function(e){var n=document.createElement("div");n.classList.add("search__container"),n.dataset.inseqno=e.inSeqNo;var c=document.createElement("img");c.classList.add("search__img"),c.src="".concat("http://grcity.iptime.org",":").concat("80","/").concat(e.inCarPicName),c.alt="이미지를 불러오지 못했습니다.";var a=document.createElement("div");a.classList.add("search__info");var o=document.createElement("p");o.innerText=e.inCarNo;var i=document.createElement("p");i.innerText="입차종류: ".concat(e.tkType);var r=document.createElement("p");r.innerText="입차장비: ".concat(e.unitName);var d=document.createElement("p");d.innerText="입차시간: ".concat(T(e.insDate)),a.appendChild(o),a.appendChild(i),a.appendChild(r),a.appendChild(d),n.appendChild(c),n.appendChild(a),t.append(n)})):u(t),document.querySelectorAll(".search__container").forEach((function(t){t.addEventListener("click",(function(t){var c=t.currentTarget.dataset.inseqno,a=t.currentTarget.cloneNode(!0);e.style.display="none",n.style.display="block",function(e,t){fetch("/discount/search/inseqno",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({inSeqNo:e})}).then((function(e){return e.json()})).then((function(c){var a,o=c.freeCouponList,d=c.payCouponList,l=c.discountList;n.append(t),n.querySelector(".search__container").style.border="none",n.append(i),n.append(r),h(o,"무료"),h(d,"유료"),1===(a=document.querySelectorAll(".coupon__container-type")).length&&(a[0].querySelector("h6").innerText="할인권"),m(l,e)})).catch((function(e){return console.log(e)}))}(c,a)}))}))})).catch((function(e){return console.log(e)})):alert("차량번호를 입력하세요.\nex_2258")}function m(e,n){if(0!==e.length){var t=document.createElement("div");t.classList.add("discount__header"),t.innerHTML="할인내역",r.append(t),e.map((function(e){var t=document.createElement("div");t.classList.add("discount__info-container"),t.dataset.idx=e.idx,t.dataset.dcname=e.dcName,t.dataset.coupontype=e.couponType;var c=document.createElement("div");c.classList.add("discount__info");var a=document.createElement("p");a.classList.add("discount__info-title"),a.innerText="".concat(e.dcName," 할인권");var o=document.createElement("p");o.innerText="등록매장: ".concat(e.shopName);var i=document.createElement("p");i.innerText="등록일시: ".concat(e.inTime.substring(0,10)," ").concat(e.inTime.substring(11,19)),c.appendChild(a),c.appendChild(o),c.appendChild(i);var d=document.createElement("div");d.classList.add("discount__info-delete"),d.innerHTML="삭제",d.addEventListener("click",(function(e){var t=e.currentTarget.parentNode.dataset,c=t.idx,a=t.dcname,o=t.coupontype;!function(e,n,t,c){confirm("".concat(t," 할인을 삭제하시겠습니까?"))&&fetch("/discount/list",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({idx:e,inSeqNo:n,couponType:c})}).then((function(e){return e.json()})).then((function(e){e.result&&(r.innerHTML="",m(e.list,n))})).catch((function(e){return console.log(e)}))}(c,n,a,o)})),t.appendChild(c),t.appendChild(d),r.append(t)}))}else u(r)}function h(e,t){if(0!==e.length){var c=document.createElement("div");c.classList.add("coupon__container-type");var a=document.createElement("h6");a.innerText="".concat(t,"권");var o=document.createElement("select");o.classList.add("coupon__list");var d=document.createElement("option");d.innerText="할인권 선택",d.value="00",o.append(d),o.addEventListener("change",(function(e){var t=n.querySelector(".search__container").dataset.inseqno,c=e.currentTarget,a=c.options[e.currentTarget.selectedIndex].text,o=c.value;"00"!==o&&confirm("".concat(-1===a.indexOf("잔여")?a:a.split("(")[0]," 할인을 등록하시겠습니까?"))?function(e,n){"00"!==n&&fetch("/discount/list",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({inSeqNo:e,couponType:n})}).then((function(e){return e.json()})).then((function(n){"fail"===n.result?alert(n.msg):(r.innerHTML="",m(n.list,e)),v()})).catch((function(e){return console.log(e)}))}(t,o):v()})),e.map((function(e){var n=document.createElement("option");n.innerText="".concat(e.dcName).concat("유료"===t?"(잔여:".concat(e.stock,"매)"):""),n.value="".concat(e.couponType),o.append(n)})),c.append(a),c.append(o),i.append(c)}}function v(){document.querySelectorAll("select").forEach((function(e){e.value="00"}))}function f(){var e=document.querySelector("#startDate").value,n=document.querySelector("#endDate").value,c=document.querySelector("#inCarNo").value;fetch("/discount/history",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({startDate:e,endDate:n,inCarNo:c})}).then((function(e){return e.json()})).then((function(e){var n;e.result&&(n=e.result,t.innerHTML="",0!==n.length?(t.appendChild(function(e){var n=document.createElement("p");n.innerText="조회 ",n.classList.add("views__discount");var t=document.createElement("span");return t.innerText="".concat(e,"건"),n.appendChild(t),n}(n.length)),n.map((function(e){var n=document.createElement("div");n.classList.add("search__container");var c=document.createElement("img"),a=null===e.totParkTime?e.inCarPicName:e.outCarPicName,o=null===e.totParkTime?"#f8981c":"#012d6b";c.classList.add("search__img"),c.style.width="48%",c.style.height="100px",c.style.borderColor=o,c.src="".concat("http://grcity.iptime.org",":").concat("80","/").concat(a),c.alt="이미지를 불러오지 못했습니다.";var i=document.createElement("div");i.classList.add("search__info"),i.style.fontSize="14px";var r=document.createElement("p");r.innerText="".concat(e.inCarNo," ").concat(null===e.totParkTime?"":"(".concat(e.totParkTime,"분)"));var d=document.createElement("p");d.innerText="할인종류: ".concat(e.dcName);var l=document.createElement("p");l.innerText="할인일시: ".concat(T(e.dcTime));var u=document.createElement("p");u.innerText="입차일시: ".concat(T(e.inTime));var s=document.createElement("p");s.innerText="출차일시: ".concat(null===e.outTime?"출차전":T(e.outTime)),i.appendChild(r),i.appendChild(d),i.appendChild(l),i.appendChild(u),i.appendChild(s),n.appendChild(c),n.appendChild(i),t.append(n)}))):u(t))})).catch((function(e){return console.log(e)}))}function y(){var e=document.querySelectorAll(".search__container"),n=document.querySelector("#startDate").value,t=document.querySelector("#endDate").value,c=document.querySelector("#inCarNo").value;0===e.length?alert("내려받을 내용이 없습니다."):location.href="".concat(window.location.pathname,"/excel?startDate=").concat(n,"&endDate=").concat(t,"&inCarNo=").concat(c)}function T(e){return"".concat(e.substring(5,10)," ").concat(e.substring(11,16))}r.classList.add("discount__container"),window.onload=function(){o.focus(),console.log("http://grcity.iptime.org"),document.querySelector("footer").addEventListener("click",s),o.addEventListener("input",d),"/discount/history"===window.location.pathname?(document.querySelector("#historyExcelBtn").addEventListener("click",y),document.querySelector("#historyBtn").addEventListener("click",f),a.addEventListener("click",(function(){window.history.back()})),o.addEventListener("keyup",(function(e){13==window.event.keyCode&&f()}))):"/discount/main"===window.location.pathname&&(n.style.display="none",a.addEventListener("click",l),c.addEventListener("click",p),o.addEventListener("keyup",(function(e){13==window.event.keyCode&&p()})))}})();